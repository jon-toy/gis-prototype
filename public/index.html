<!DOCTYPE html>
<html>
  <head>
    <title>GIS Prototype</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
	  
	  #info-box {
        background-color: white;
        border: 1px solid black;
        bottom: 30px;
        padding: 10px;
        position: absolute;
        left: 30px;		
		display: grid;
      }
	  
	  .info-panel {
		display: grid;
	  }
	  
	  .info-title {
		grid-column-start: 1;
		padding: .5em;
	  }
	  
	  .info-content {
		grid-column-start: 3;
		padding: .5em;
	  }
    </style>
  </head>
  <body>
	<div id="controls">
		<div>
			Latitude: 
			<input type="number" id="lat">
			Longitude: 
			<input type="number" id="lon">
			<button type="button" onclick="goToLatLon();">Go</button>
		</div>	
		
		<div>
			Search by Parcel Number
			<input type="text">
			<button type="button" onclick="goToParcel();">Search</button>
		</div>
	</div>
    <div id="map"></div>
	<div id="info-box"></div>
    <script>
      var map;
	  
	  function goToParcel()
	  {
		// TODO
	  }
	  
	  function goToLatLon()
	  {
		var lat_val = parseFloat(document.getElementById("lat").value);
		var lon_val = parseFloat(document.getElementById("lon").value);
		
		var my_lat_lon = {lat: lat_val, lng: lon_val};
		
        initMap(my_lat_lon);
	  }
	  
      function initMap(my_lat_lon) 
	  {
		if ( my_lat_lon == null ) my_lat_lon = {lat: 33.837655219463926, lng: -109.11409610177091};
		
        map = new google.maps.Map(document.getElementById('map'), {
          center: my_lat_lon,
          zoom: 18
        });
		
		map.data.loadGeoJson(
            './parcel4poly.json');
			
		map.data.addListener('mouseover', function(event) 
		{			
			var parcel = event.feature.getProperty('PARCEL_NUM');
			var state = event.feature.getProperty('STATE');
			var township = event.feature.getProperty('TOWNSHIP');
			var range = event.feature.getProperty('RANGE');
			var sec_no = event.feature.getProperty('SEC_NO');
			
			var info_box = document.getElementById('info-box');
			info_box.innerHTML = "";
			
			renderProperty(info_box, "Parcel Number", parcel);
			renderProperty(info_box, "Description", event.feature.getProperty('DESCRIPTIO'));
			renderProperty(info_box, "FCV", event.feature.getProperty('FCV'));
			renderProperty(info_box, "Legal", event.feature.getProperty('LEGAL'));
			renderProperty(info_box, "Line 1", event.feature.getProperty('LINE_1'));
			renderProperty(info_box, "Line 2", event.feature.getProperty('LINE_2'));
			renderProperty(info_box, "Number", event.feature.getProperty('NUMBER'));
			renderProperty(info_box, "Owner", event.feature.getProperty('OWNER'));
			renderProperty(info_box, "Owner City", event.feature.getProperty('OWNER_CITY'));
			renderProperty(info_box, "Owner Zip", event.feature.getProperty('OWNER_ZIP'));
			renderProperty(info_box, "Situs", event.feature.getProperty('SITUS'));
			renderProperty(info_box, "Size", event.feature.getProperty('SIZE'));
			renderProperty(info_box, "State", state);
			renderProperty(info_box, "State 0", event.feature.getProperty('STATE0'));
			renderProperty(info_box, "Township", township);
			renderProperty(info_box, "Range", range);
			renderProperty(info_box, "Section No.", sec_no);
		});
		
		// Color each letter gray. Change the color when the isColorful property
		// is set to true.
		map.data.setStyle(function(feature) {
		  var color = 'gray';
		  if (feature.getProperty('isColorful')) {
			color = feature.getProperty('color');
		  }
		  return /** @type {google.maps.Data.StyleOptions} */({
			fillColor: color,
			strokeColor: color,
			strokeWeight: 2
		  });
		});

		// When the user clicks, set 'isColorful', changing the color of the letters.
		map.data.addListener('click', function(event) {
		  event.feature.setProperty('isColorful', true);
		});

		// When the user hovers, tempt them to click by outlining the letters.
		// Call revertStyle() to remove all overrides. This will use the style rules
		// defined in the function passed to setStyle()
		map.data.addListener('mouseover', function(event) {
		  map.data.revertStyle();
		  map.data.overrideStyle(event.feature, {strokeWeight: 8});
		});

		map.data.addListener('mouseout', function(event) {
		  map.data.revertStyle();
		});
      }
	  
	  function renderProperty(container, title, content)
	  {
		if ( content == null ) return;
		var title_container = document.createElement('div');
		title_container.className = 'info-title';
		title_container.innerHTML = title;
		container.appendChild(title_container);
		
		var content_container = document.createElement('div');
		content_container.className = 'info-content';
		content_container.innerHTML = content;
		container.appendChild(content_container);
	  }
	  
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD38DbmmFvH9emgUV6sTfhrrk7JpMShEsI&callback=initMap"
    async defer></script>
  </body>
</html>